{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Masala Story{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="{% static 'css/theme.css' %}?v=20250109" rel="stylesheet">
    <style>
      /* Header sizing tweaks */
      .brand-logo{ 
        height: 110px; 
        width: auto; 
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        transition: all 0.3s ease;
      }
      .brand-logo:hover {
        transform: scale(1.05);
        filter: drop-shadow(0 4px 8px rgba(0,0,0,0.4));
      }
      @media (max-width: 576px){ .brand-logo{ height: 84px; } }
      .navbar{ 
        padding-top: 1rem; 
        padding-bottom: 1rem; 
      }
      .navbar-dark .navbar-nav .nav-link {
        color: rgba(255, 255, 255, 0.95) !important;
        font-weight: 500;
        font-size: 1.1rem;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
      }
      .navbar-dark .navbar-nav .nav-link:hover {
        color: white !important;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
        transform: translateY(-1px);
      }
      .navbar-dark .navbar-nav .nav-link.active {
        color: white !important;
        font-weight: 600;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
      }
      .navbar-dark .navbar-brand {
        color: white !important;
        font-weight: 700;
        font-size: 1.3rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }
      .navbar-dark .dropdown-toggle::after {
        border-top-color: rgba(255, 255, 255, 0.8);
      }
      /* Header search bar */
      .header-search.input-group{ border-radius: 999px; overflow: hidden; }
      .header-search .form-control{
        background-color: rgba(255,255,255,0.12);
        border: 1px solid rgba(255,255,255,0.28);
        border-right: none;
        color: #fff;
        font-size: 1rem;
        padding: 0.7rem 1rem;
        min-width: 260px;
      }
      .header-search .form-control::placeholder{ color: rgba(255,255,255,0.75); letter-spacing: .2px; }
      .header-search .form-control:focus{
        background-color: rgba(255,255,255,0.18);
        border-color: rgba(255,255,255,0.6);
        color: #fff;
        box-shadow: 0 0 0 0.2rem rgba(255,255,255,0.25);
      }
      .header-search .btn{
        border: 1px solid rgba(255,255,255,0.28);
        border-left: none;
        background: rgba(255,255,255,0.12);
        color: #fff;
        padding: 0.7rem 1rem;
      }
      .header-search .btn:hover{ background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.6); }
      @media (min-width: 992px){ .header-search .form-control{ min-width: 360px; } }
      .navbar-dark .btn-outline-light {
        border-color: rgba(255, 255, 255, 0.5);
        color: white;
        background-color: rgba(255, 255, 255, 0.1);
        font-size: 1rem;
        padding: 0.75rem 1rem;
      }
      .navbar-dark .btn-outline-light:hover {
        background-color: rgba(255, 255, 255, 0.2);
        border-color: white;
        color: white;
      }
      .navbar-dark .dropdown-menu {
        font-size: 1rem;
      }
      .navbar-dark .dropdown-item {
        font-size: 1rem;
        padding: 0.75rem 1rem;
      }
      @media (max-width: 768px) {
        .navbar-dark .navbar-nav .nav-link {
          font-size: 1rem;
        }
        .navbar-dark .navbar-brand {
          font-size: 1.2rem;
        }
        .navbar-dark .form-control {
          font-size: 0.95rem;
          padding: 0.6rem 0.8rem;
        }
        .navbar-dark .btn-outline-light {
          font-size: 0.95rem;
          padding: 0.6rem 0.8rem;
        }
      }
      /* Footer spacing tweaks */
      footer .container{ padding-top: 1.25rem !important; padding-bottom: 1.25rem !important; }
      .footer-logo{ height: 64px; width: auto; }
      /* Category thumbnails sizing (prevents huge images) */
      .category-photo{
        width: 80px; height: 80px; object-fit: cover; border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,.12); border: 1px solid rgba(0,0,0,.06);
      }
      @media (max-width: 576px){
        .category-photo{ width: 64px; height: 64px; }
      }
      @media (min-width: 992px){
        .category-photo{ width: 96px; height: 96px; }
      }
      .category-card .card-body{ text-align: center; }
      /* Product grid image constraints */
      .product-thumb{ height: 220px; object-fit: cover; width: 100%; display: block; }
      .card-img-top{ width: 100%; }
      @media (max-width: 576px){ .product-thumb{ height: 180px; } }
      /* Force uniform product image sizing */
      .product-card .position-relative{ 
        height: 200px !important; 
        overflow: hidden !important;
        background: #f8f9fa !important;
        position: relative !important;
        display: block !important;
      }
      /* Product card borders and alignment */
      .product-card {
        border: none !important;
        border-radius: 8px !important;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05) !important;
        transition: all 0.3s ease !important;
        background: white !important;
        margin-bottom: 0.5rem !important;
      }
      .product-card:hover {
        box-shadow: 0 4px 16px rgba(0,0,0,0.15) !important;
        transform: translateY(-2px) !important;
      }
      /* Product grid alignment */
      .row.g-4 {
        align-items: stretch !important;
      }
      .row.g-4 > [class*="col-"] {
        display: flex !important;
        flex-direction: column !important;
      }
      .row.g-4 .product-card {
        flex: 1 !important;
        display: flex !important;
        flex-direction: column !important;
      }
      /* Reduce product card spacing - ULTRA TIGHT */
      .product-card .card-body {
        padding: 0.2rem !important;
      }
      .product-card .card-title {
        margin-bottom: 0.05rem !important;
        font-size: 1.1rem !important;
        line-height: 1.1 !important;
        font-weight: bold !important;
      }
      .product-card .card-text {
        margin-bottom: 0.05rem !important;
        margin-top: 0.05rem !important;
        font-size: 0.9rem !important;
      }
      .product-card .card-footer {
        padding: 0.1rem 0.2rem !important;
        margin-top: auto !important;
      }
      .product-card .btn {
        padding: 0.2rem 0.4rem !important;
        font-size: 0.7rem !important;
      }
      .product-card .price {
        margin-bottom: 0.05rem !important;
        font-size: 0.95rem !important;
        font-weight: bold !important;
      }
      .product-card .badge {
        font-size: 0.75rem !important;
        padding: 0.2rem 0.5rem !important;
      }
      /* Force spacing overrides - ULTRA TIGHT */
      .product-card .card-body > * {
        margin-bottom: 0.05rem !important;
      }
      .product-card .card-body > *:last-child {
        margin-bottom: 0 !important;
      }
      .product-card .mt-auto {
        margin-top: 0.05rem !important;
      }
      .product-card .mb-3 {
        margin-bottom: 0.05rem !important;
      }
      .product-card .gap-2 {
        gap: 0.05rem !important;
      }
      .product-card h5 {
        margin-bottom: 0.05rem !important;
      }
      .product-card p {
        margin-bottom: 0.05rem !important;
      }
      .product-card div {
        margin-bottom: 0.05rem !important;
      }
      .product-card * {
        margin-bottom: 0.05rem !important;
      }
      .product-card *:last-child {
        margin-bottom: 0 !important;
      }
      .product-card img.card-img-top{ 
        height: 200px !important; 
        width: 100% !important;
        object-fit: cover !important; 
        object-position: center !important; 
        display: block !important; 
        border-radius: 0 !important;
        position: absolute !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
      }
      .product-card .d-flex.align-items-center{ 
        height: 200px !important; 
      }
      @media (max-width: 576px){ 
        .product-card .position-relative{ height: 150px !important; }
        .product-card img.card-img-top{ height: 150px !important; } 
        .product-card .d-flex.align-items-center{ height: 150px !important; }
      }
      /* Aggressive product image sizing override - 3 products per row */
      .row.g-4 .col-12 .card img,
      .row.g-4 .col-sm-6 .card img,
      .row.g-4 .col-lg-4 .card img {
        height: 200px !important;
        width: 100% !important;
        object-fit: cover !important;
        object-position: center !important;
      }
      @media (max-width: 576px) {
        .row.g-4 .col-12 .card img,
        .row.g-4 .col-sm-6 .card img,
        .row.g-4 .col-lg-4 .card img {
          height: 160px !important;
        }
      }
      /* Featured products specific sizing */
      .content-section .row.g-4 .col-lg-3 .card img {
        height: 200px !important;
        width: 100% !important;
        object-fit: cover !important;
        object-position: center !important;
      }
      .content-section .row.g-4 .col-lg-3 .position-relative {
        height: 200px !important;
        overflow: hidden !important;
      }
      /* Filters panel fallback visibility */
      .filter-panel{ display: none; }
      .filter-panel.show{ display: block; }
    </style>
</head>
<body class="d-flex flex-column min-vh-100">
<header>
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
      <div class="container-fluid">
        <a class="navbar-brand fw-bold d-flex align-items-center gap-2" href="/">
          <img src="{% static 'img/logo.png' %}" alt="Masala Story" class="brand-logo" />
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}" href="{% url 'home' %}">
                <i class="bi bi-house me-1"></i>Home
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if request.resolver_match.url_name == 'product_list' %}active{% endif %}" href="{% url 'catalog:product_list' %}">
                <i class="bi bi-grid me-1"></i>Products
              </a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navCategories" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-tags me-1"></i>Categories
              </a>
              <ul class="dropdown-menu" aria-labelledby="navCategories">
                {% for c in categories|default:None %}
                  <li><a class="dropdown-item" href="{% url 'catalog:product_list' %}?category={{ c.slug }}">{{ c.name }}</a></li>
                {% empty %}
                  <li><a class="dropdown-item" href="{% url 'catalog:product_list' %}">All Products</a></li>
                {% endfor %}
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="{% url 'catalog:product_list' %}">Browse All</a></li>
              </ul>
            </li>
          </ul>
          
          <form class="d-flex me-4" role="search" action="{% url 'catalog:product_list' %}" method="get">
            <div class="input-group header-search">
              <input class="form-control" name="q" type="search" placeholder="Search spices..." value="{{ request.GET.q }}">
              <button class="btn" type="submit">
                <i class="bi bi-search"></i>
              </button>
            </div>
          </form>
          
          <ul class="navbar-nav mb-2 mb-lg-0 align-items-center">
            <li class="nav-item me-2">
              <a class="nav-link position-relative" href="{% url 'cart:view' %}">
                <i class="bi bi-cart3 me-1"></i>Cart
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning text-dark">
                  {{ cart_item_count|default:0 }}
                </span>
              </a>
            </li>
            <li class="nav-item me-2">
              <a class="nav-link position-relative" href="{% url 'cart:wishlist' %}">
                <i class="bi bi-heart me-1"></i>Wishlist
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning text-dark">
                  {{ wishlist_item_count|default:0 }}
                </span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if request.resolver_match.url_name == 'contact' %}active{% endif %}" href="{% url 'contact' %}">
                <i class="bi bi-envelope me-1"></i>Contact
              </a>
            </li>
            {% if request.user.is_authenticated %}
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle {% if request.resolver_match.url_name == 'profile' %}active{% endif %}" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="bi bi-person-circle me-1"></i>{{ request.user.username|truncatechars:15 }}
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li><a class="dropdown-item" href="{% url 'accounts:profile' %}">
                    <i class="bi bi-person me-2"></i>My Profile
                  </a></li>
                  <li><a class="dropdown-item" href="{% url 'cart:orders' %}">
                    <i class="bi bi-bag me-2"></i>My Orders
                  </a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <form method="post" action="{% url 'accounts:logout' %}" class="d-inline">
                      {% csrf_token %}
                      <button type="submit" class="dropdown-item text-danger">
                        <i class="bi bi-box-arrow-right me-2"></i>Logout
                      </button>
                    </form>
                  </li>
                </ul>
              </li>
            {% else %}
              <li class="nav-item">
                <a class="nav-link {% if request.resolver_match.url_name == 'login' %}active{% endif %}" href="{% url 'accounts:login' %}">
                  <i class="bi bi-box-arrow-in-right me-1"></i>Login
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link {% if request.resolver_match.url_name == 'signup' %}active{% endif %} btn btn-outline-light ms-2" href="{% url 'accounts:signup' %}" style="border-radius: 20px; padding: 0.375rem 1rem;">
                  <i class="bi bi-person-plus me-1"></i>Sign Up
                </a>
              </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>
    </header>
    
    {% if messages %}
        <div class="container mt-3">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags|default:'info' }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        </div>
    {% endif %}
    
    <main class="container my-5 flex-grow-1 pb-5">
        {% block content %}{% endblock %}
    </main>
    <footer class="text-light mt-4 pt-4" style="background: radial-gradient(ellipse at top left, rgba(233,196,106,.25), transparent 60%), radial-gradient(ellipse at bottom right, rgba(42,157,143,.25), transparent 60%), #111;">
      <div class="container py-4">
        <div class="row g-3 align-items-start">
          <div class="col-12 col-lg-4">
            <div class="d-flex align-items-center mb-4">
              <img src="{% static 'img/logo.png' %}" alt="Masala Story" class="footer-logo me-3" />
              <h5 class="fw-bold m-0">Masala Story</h5>
            </div>
            <p class="text-muted mb-3 lh-lg">Authentic Indian spices, hand-picked and freshly packed for your kitchen. Discover the rich flavors that make every meal special.</p>
            <small class="text-secondary">© <span id="year"></span> Masala Story · All rights reserved</small>
          </div>
          <div class="col-6 col-lg-2">
            <h6 class="text-uppercase text-secondary small mb-3 fw-bold">Shop</h6>
            <ul class="list-unstyled m-0">
              <li class="mb-2"><a class="link-light text-decoration-none hover-glow" href="{% url 'catalog:product_list' %}">All Products</a></li>
              <li class="mb-2"><a class="link-light text-decoration-none hover-glow" href="{% url 'catalog:product_list' %}?category=">Categories</a></li>
              <li class="mb-2"><a class="link-light text-decoration-none hover-glow" href="#">Best Sellers</a></li>
              <li class="mb-2"><a class="link-light text-decoration-none hover-glow" href="#">New Arrivals</a></li>
            </ul>
          </div>
          <div class="col-6 col-lg-2">
            <h6 class="text-uppercase text-secondary small mb-3 fw-bold">Account</h6>
            <ul class="list-unstyled m-0">
              <li class="mb-2"><a class="link-light text-decoration-none hover-glow" href="{% url 'accounts:login' %}">Login</a></li>
              <li class="mb-2"><a class="link-light text-decoration-none hover-glow" href="{% url 'accounts:signup' %}">Sign up</a></li>
              <li class="mb-2"><a class="link-light text-decoration-none hover-glow" href="{% url 'accounts:profile' %}">My Profile</a></li>
              <li class="mb-2"><a class="link-light text-decoration-none hover-glow" href="{% url 'cart:orders' %}">Order History</a></li>
            </ul>
          </div>
          <div class="col-12 col-lg-4">
            <h6 class="text-uppercase text-secondary small mb-3 fw-bold">Newsletter</h6>
            <p class="text-muted mb-3 small">Get the latest spice tips, recipes, and exclusive offers delivered to your inbox.</p>
            <form class="d-flex gap-2 mb-3" onsubmit="event.preventDefault(); alert('Thanks for subscribing!');">
              <input type="email" class="form-control" placeholder="Your email address" required>
              <button class="btn btn-primary px-4" type="submit">Subscribe</button>
            </form>
            <div class="d-flex gap-4 mt-3">
              <a href="#" class="link-light text-decoration-none hover-glow d-flex align-items-center">
                <i class="bi bi-instagram me-2"></i> Instagram
              </a>
              <a href="#" class="link-light text-decoration-none hover-glow d-flex align-items-center">
                <i class="bi bi-twitter-x me-2"></i> Twitter/X
              </a>
              <a href="#" class="link-light text-decoration-none hover-glow d-flex align-items-center">
                <i class="bi bi-facebook me-2"></i> Facebook
              </a>
            </div>
          </div>
        </div>
        <hr class="border-secondary opacity-25 my-4">
        <div class="d-flex justify-content-between align-items-center small text-secondary py-2">
          <div class="d-flex gap-4">
            <a href="#" class="text-secondary text-decoration-none hover-glow">Terms</a>
            <a href="#" class="text-secondary text-decoration-none hover-glow">Privacy</a>
            <a href="#" class="text-secondary text-decoration-none hover-glow">Refunds</a>
            <a href="#" class="text-secondary text-decoration-none hover-glow">Contact</a>
          </div>
          <div>Made with ♥ for spice lovers</div>
        </div>
      </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
      (function(){
        var y = document.getElementById('year'); if (y) { y.textContent = new Date().getFullYear(); }
      })();
    </script>
</body>
</html>


